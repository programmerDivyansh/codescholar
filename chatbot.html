<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Helper Bot</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header { background-color: darkblue; color: white; padding: 10px; text-align: center; }
        main { padding: 16px; }
        #chat {
            border: 1px solid #ccc;
            background: white;
            height: 400px;
            overflow-y: auto;
            padding: 8px;
            margin-bottom: 8px;
        }
        .message { margin: 8px 0; }
        .user { text-align: right; color: blue; }
        .bot { text-align: left; color: darkred; }
        .bubble {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 80%;
        }
        .user .bubble { background: #d1e7ff; }
        .bot .bubble { background: #ffe7d1; }
        #inputRow { display: flex; }
        #userInput { flex: 1; padding: 8px; font-size: 1em; }
        #sendBtn { padding: 8px 16px; }
    </style>
</head>
<body>
    <header>
        <h1>HyperBot â€“ HTML Helper ðŸ¤–</h1>
        <p>Ask me anything about HTML!</p>
    </header>
    <main>
        <div id="chat"></div>
        <div id="inputRow">
            <input id="userInput" type="text" placeholder="Type a question..." />
            <button id="sendBtn">Send</button>
        </div>
    </main>
    <script>
        // rule-based chatbot data
        const responses = {
            "what is html": "HTML stands for HyperText Markup Language. It is the standard language for creating web pages.\n\nAn HTML file contains tags enclosed in angle brackets. Elements can have attributes and are nested inside each other. The browser reads this markup and displays text, images, forms, and other content accordingly.\n\nAsk me for an example, the full structure, or details about any specific tag!",
            "how do i make a link": "Use the <a> element with an href attribute, e.g. <code>&lt;a href=\"https://example.com\"&gt;link&lt;/a&gt;</code>.",
            "how do i write a paragraph": "Wrap your text in <code>&lt;p&gt;...&lt;/p&gt;</code>. For example: <code>&lt;p&gt;Hello world!&lt;/p&gt;</code> creates a separate paragraph on the page.",
            "p tag code": "A paragraph tag looks like <code>&lt;p&gt;Some text&lt;/p&gt;</code>. Make sure to include both opening and closing tags.",
            "paragraph tag": "Use <code>&lt;p&gt;Your paragraph here&lt;/p&gt;</code> to produce a paragraph element.",
            "favicon": "A favicon is a small icon displayed in the browser tab. Use <code>&lt;link rel=\"icon\" href=\"/path/icon.ico\"&gt;</code> in the head.",
            "what is a div": "A <div> is a generic container element used to group other elements together for styling or scripting.",
            "html structure": "An HTML document typically starts with <!DOCTYPE html>, then an <html> element, a <head> for metadata, and a <body> for content.",
            "default": "I know a lot about HTML â€“ ask me about tags, elements, attributes, structure, forms, media, etc.\nYou can also ask for an example or the full structure.\nI can even look through the course pages on this site if your question matches something written there.\nSometimes I donâ€™t catch vague wording; try asking again with a few specific words or rephrase your question."
        };
        
        // more comprehensive reference keyed by key words
        const htmlInfo = {
            /* structural */
            "html": "The root element of an HTML document. Everything else is nested inside it.",
            "head": "Contains metadata about the document, such as <title>, <meta>, <link>, <style>, and <script>.",
            "body": "The section of an HTML document that contains the content visible to the user.",
            "title": "Defines the title of the document shown in the browser tab; placed inside <head>.",
            "doctype": "<!DOCTYPE html> declares the document type and version of HTML.",
            "structure": "A basic HTML document has this structure:\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Your title here</title>\n</head>\n<body>\n  <!-- content goes here -->\n</body>\n</html>\n\nElements are nested inside one another and the browser renders them accordingly. Use <head> for metadata (title, scripts, styles) and <body> for content users see.\n\nYou can add sections, headings, paragraphs, images, forms, and more inside the body.",

            /* metadata & links */
            "meta": "Provides metadata such as character set, viewport, description, and keywords.",
            "link": "Used to link external resources like stylesheets or favicons.",
            "base": "Specifies the base URL for relative URLs in the document.",

            /* text & semantics */
            "p": "A paragraph element is written using <p> and </p>.\nExample: <p>This is a paragraph.</p>\nThe browser renders it as a block of text separated from other content. Use it to wrap lines of text that belong together.",
            "h1": "Heading level 1. There are six heading levels from h1 to h6.",
            "h2": "Heading level 2.",
            "h3": "Heading level 3.",
            "h4": "Heading level 4.",
            "h5": "Heading level 5.",
            "h6": "Heading level 6.",
            "blockquote": "Section quoted from another source.",
            "code": "Represents a fragment of computer code.",
            "pre": "Preformatted text, preserves whitespace and line breaks.",
            "em": "Emphasized text, typically rendered in italics.",
            "strong": "Strong importance, typically rendered in bold.",
            "small": "Smaller text for fine print.",
            "s": "Strikethrough text.",
            "u": "Underlined text.",
            "cite": "A citation of a creative work.",
            "dfn": "Definition term.",
            "abbr": "Abbreviation or acronym.",
            "address": "Contact information for the author/owner.",
            "b": "Stylistically offset text without extra importance.",
            "i": "Text in an alternate voice or mood.",
            "mark": "Marked or highlighted text.",
            "q": "Inline quotation.",
            "var": "Variable name.",
            "time": "Represents a specific time or date.",
            "kbd": "User input (keyboard).",
            "samp": "Sample output from a program.",
            "sub": "Subscript text.",
            "sup": "Superscript text.",

            /* grouping & sections */
            "div": "A generic blockâ€‘level container that groups other elements.",
            "span": "An inline container used to mark up a part of a text or a document.",
            "section": "Generic section of a document, often with a heading.",
            "article": "Independent, self-contained piece of content.",
            "aside": "Content tangentially related to the main content, like a sidebar.",
            "nav": "Semantic container for a set of navigation links.",
            "header": "Semantic container for introductory content or navigation links.",
            "footer": "Semantic container for footer content.",
            "main": "The main content of the <body>, unique to the document.",
            "figure": "Represents selfâ€‘contained content, likely with a caption (<figcaption>).",
            "figcaption": "Caption for a <figure>.",
            "details": "Disclosure widget that the user can open and close.",
            "summary": "Summary, visible when the <details> element is closed.",
            "dialog": "Dialog box or window.",

            /* lists */
            "ul": "Unordered list. Contains <li> items.",
            "ol": "Ordered (numbered) list. Contains <li> items.",
            "li": "List item, used inside ul or ol.",
            "dl": "Description list.",
            "dt": "Term/name in a description list.",
            "dd": "Description of a term in a description list.",
            "menu": "List of commands or menu items.",
            "menuitem": "Command that a user can invoke from a popup menu.",

            /* tables */
            "table": "Defines a table. Rows are made with <tr>, cells with <td> or <th>.",
            "tr": "Table row.",
            "td": "Table cell (data).",
            "th": "Table header cell.",
            "thead": "Group of header rows in a table.",
            "tbody": "Group of body rows in a table.",
            "tfoot": "Group of footer rows in a table.",
            "caption": "Title or explanatory text for a table.",
            "colgroup": "Group of columns in a table.",
            "col": "Column definition inside a colgroup.",

            /* forms & interactive */
            "form": "A container for user input controls, used to submit data to a server.",
            "input": "Form input field. Type attribute controls behaviour (text, password, checkbox, etc.).",
            "textarea": "Multi-line text input field.",
            "button": "Clickable button, often used inside a form.",
            "select": "Dropdown list. Contains <option> elements.",
            "option": "Option inside a select.",
            "optgroup": "Group of options inside a select.",
            "label": "Label for a form control.",
            "fieldset": "Group related form controls together.",
            "legend": "Caption for a fieldset.",
            "output": "Represents the result of a calculation or user action.",
            "meter": "Represents a scalar measurement within a known range, or a fractional value.",
            "progress": "Represents progress of a task.",
            "datalist": "Contains a set of <option> elements that represent permissible values for other controls.",
            "keygen": "Obsolete; used for generating key-pairs.",
            "command": "Obsolete interactive command.",

            /* embedded content */
            "audio": "Embeds an audio player.",
            "video": "Embeds a video player.",
            "source": "Media source for <audio> or <video>.",
            "track": "Text tracks for media (<video>/<audio>).",
            "img": "Embeds an image. Use src attribute for the file path and alt for alternate text.",
            "map": "Image map with clickable areas.",
            "area": "Defines a clickable area inside an <map>.",
            "canvas": "Used to draw graphics via scripting (usually JavaScript).",
            "svg": "Scalable Vector Graphics element for drawing vector images.",
            "iframe": "Embeds another HTML page within the current one.",
            "embed": "Generic container for external content (e.g. plugin).",
            "object": "Generic external resource container, can be used for PDF, Flash, etc.",
            "param": "Parameter for <object>.",
            "picture": "Container for multiple image sources (<source> inside).",
            "blockquote": "Large quotation.",

            /* scripting & style */
            "script": "Used to add JavaScript to a page; can be inline or loaded from a file.",
            "noscript": "Fallback content for browsers without scripting.",
            "style": "Contains CSS rules.",

            /* other semantics */
            "slot": "Placeholder in Web Components for user-provided content.",
            "template": "Client-side template that isnâ€™t rendered until activated.",

            /* attributes & concepts */
            "attribute": "Attributes provide additional information about elements, e.g. href, src, class, id.",
            "class": "Used to classify elements for styling with CSS or scripting.",
            "id": "Unique identifier for an element. Should be unique within the document.",
            "css": "Cascading Style Sheets; used to style HTML elements.",
            "javascript": "Programming language used to add behaviour to web pages.",
                "example": "Here\'s a simple HTML file example that shows structure and output:\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Example</title>\n</head>\n<body>\n  <h1>Hello world!</h1>\n  <p>This is a paragraph.</p>\n</body>\n</html>\n\nWhen opened in a browser you see a heading and a paragraph."
        };
        
        // small library of example code snippets (escaped when shown)
        const htmlExamples = {
            "p": "<p>Hello world!</p>\nA paragraph is a block element used for text.",
            "a": "<a href=\"https://example.com\">Visit example</a>\nUse the href attribute to set the destination.",
            "img": "<img src=\"image.jpg\" alt=\"description\">\nInclude alt text for accessibility.",
            "ul": "<ul>\n  <li>Item 1</li>\n  <li>Item 2</li>\n</ul>\nUnordered list with list items.",
            "ol": "<ol>\n  <li>First</li>\n  <li>Second</li>\n</ol>\nNumbered list.",
            "li": "<li>List item</li>\nUsed inside <ul> or <ol>.",
            "div": "<div class=\"container\">Content</div>\nGeneric block container.",
            "span": "<span class=\"highlight\">Inline text</span>\nInline container for text.",
            "form": "<form action=\"/submit\" method=\"post\">\n  <input name=\"name\">\n  <button type=\"submit\">Send</button>\n</form>\nA simple form.",
            "input": "<input type=\"text\" name=\"name\" placeholder=\"Your name\">\nUse the type attribute to change behaviour.",
            "button": "<button type=\"button\">Click me</button>\nClickable button element.",
            "table": "<table>\n  <tr><th>Head</th></tr>\n  <tr><td>Cell</td></tr>\n</table>\nBasic table structure.",
            "script": "<script>console.log('hi')<\/script>\nAdd JavaScript; place at end of body for faster loading.",
            "style": "<style>p{color:blue}</style>\nInline CSS; prefer external stylesheets for larger projects.",
            "link": "<link rel=\"stylesheet\" href=\"styles.css\">\nLink to external CSS in the head.",
            "meta": "<meta charset=\"UTF-8\">\nCommon meta tags include charset and viewport.",
            "iframe": "<iframe src=\"https://example.com\" width=\"600\" height=\"400\"></iframe>\nEmbeds another page.",
            "video": "<video src=\"movie.mp4\" controls></video>\nUse controls and source attributes for media.",
            "audio": "<audio src=\"sound.mp3\" controls></audio>\nSimple audio embedding.",
            "canvas": "<canvas id=\"c\" width=\"300\" height=\"150\"></canvas>\nUse JS to draw on canvas.",
            "default": null
        };

        function escapeHtml(s) {
            return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function generateExample(term) {
            const tag = term.replace(/[^a-z0-9]/gi, '').toLowerCase();
            if (!tag) return null;
            if (htmlExamples[tag]) return htmlExamples[tag];
            if (htmlInfo[tag]) return `Example usage:\n${escapeHtml('<'+tag+'>')}...${escapeHtml('</'+tag+'>')}\n${htmlInfo[tag]}`;
            // fallback to comprehensive html5 elements data if available
            if (window.html5Elements && html5Elements[tag]) {
                const info = html5Elements[tag];
                const parts = [];
                if (info.structure) parts.push('Structure: ' + escapeHtml(info.structure));
                if (info.example) parts.push('Example: ' + escapeHtml(info.example));
                if (info.void) parts.push('Note: This is a void (self-closing) element.');
                return parts.join('\n\n');
            }
            return null;
        }

        // siteContent will be populated by loading JSON file containing stripped page text
        let siteContent = {};
        fetch('site_content.json')
            .then(r => r.json())
            .then(json => { siteContent = json; })
            .catch(err => console.error('failed to load site content', err));

        // load comprehensive HTML5 elements file (structure + examples)
        let html5Elements = {};
        fetch('html5_elements.json')
            .then(r => r.json())
            .then(json => { html5Elements = json; window.html5Elements = html5Elements; })
            .catch(err => console.warn('html5_elements.json not found or failed to load', err));

        const chatEl = document.getElementById('chat');
        const inputEl = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        function appendMessage(text, sender) {
            const msg = document.createElement('div');
            msg.className = 'message ' + (sender === 'user' ? 'user' : 'bot');
            const bubble = document.createElement('span');
            bubble.className = 'bubble';
            // if the response contains escaped HTML like &lt;p&gt; treat it as code and render in a code block
            if (text.includes('&lt;') || /&lt;\/?[a-z0-9]+&gt;/i.test(text)) {
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                // unescape entities so the code block shows actual tags as text
                const unescaped = text.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
                code.textContent = unescaped;
                pre.appendChild(code);
                bubble.appendChild(pre);
            } else {
                // convert newlines to <br> so multi-line responses display correctly
                bubble.innerHTML = text.replace(/\n/g, '<br>');
            }
            msg.appendChild(bubble);
            chatEl.appendChild(msg);
            chatEl.scrollTop = chatEl.scrollHeight;
        }

        function getResponse(question) {
            const original = question.trim();
            const key = original.toLowerCase();
            // direct match in simple responses
            if (responses[key]) return responses[key];

            // if user explicitly asks how to write or wants code, try to return an example
            if (/\b(how to write|how do i write|how to make|how to create|write a|write the|code for|example of|show me code)\b/i.test(original)) {
                // check for angle bracket tag like <p>
                const angleMatch = original.match(/<\s*([a-z0-9]+)\s*>/i);
                if (angleMatch) {
                    const tag = angleMatch[1].toLowerCase();
                    const ex = generateExample(tag);
                    if (ex) return ex.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                }
                // check for plain-word tag names
                const words = key.split(/\W+/).filter(Boolean);
                for (const w of words) {
                    if (htmlInfo[w]) {
                        const ex = generateExample(w);
                        if (ex) return ex.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    }
                }
            }

            // list request
            if (key.includes('list') && key.includes('tags')) {
                return 'Common HTML tags/topics: ' + Object.keys(htmlInfo).join(', ');
            }

            // handle queries like "what is <div>" or "<a> tag" â€” prefer examples/structure when available
            const angleMatch = original.match(/<\s*([a-z0-9]+)\s*>/i);
            if (angleMatch) {
                const tag = angleMatch[1].toLowerCase();
                // prefer example/structure from examples or html5Elements
                const ex = generateExample(tag);
                if (ex) return ex.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                if (htmlInfo[tag]) {
                    return htmlInfo[tag];
                } else {
                    return `The <${tag}> element is part of HTML. I don't have full details yet, but you can look it up on MDN (developer.mozilla.org).`;
                }
            }

            // search for any keyword inside htmlInfo
            for (const term in htmlInfo) {
                if (key.includes(term)) {
                    // if the user also asked for code/example, try to return an example
                    if (/(code|example|how to|how do i|write|show me)/i.test(key)) {
                        const ex = generateExample(term);
                        if (ex) return ex.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    }
                    return htmlInfo[term];
                }
            }

            // if siteContent has been loaded, look for matching pages
            if (Object.keys(siteContent).length > 0) {
                // try full question first
                for (const page in siteContent) {
                    const text = siteContent[page].toLowerCase();
                    if (text.includes(key)) {
                        return `From ${page}: ` + siteContent[page].split('. ').slice(0,3).join('. ') + '.';
                    }
                }
                // split into words and search each word
                const words = key.split(/\W+/).filter(w => w.length>2);
                for (const word of words) {
                    for (const page in siteContent) {
                        if (siteContent[page].toLowerCase().includes(word)) {
                            return `From ${page}: ` + siteContent[page].split('. ').slice(0,3).join('. ') + '.';
                        }
                    }
                }
            }

            // if user asked for an example explicitly
            if (key.includes('example') || key.includes('sample')) {
                return htmlInfo['example'];
            }

            return responses['default'];
        }

        sendBtn.addEventListener('click', () => {
            const text = inputEl.value;
            if (!text) return;
            appendMessage(text, 'user');
            const reply = getResponse(text);
            setTimeout(() => appendMessage(reply, 'bot'), 300);
            inputEl.value = '';
        });

        inputEl.addEventListener('keydown', e => {
            if (e.key === 'Enter') sendBtn.click();
        });
    </script>
</html>
